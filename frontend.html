<!doctype html>
<html lang="en">
<head>
    <title>Carpark Information</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css'
        rel='stylesheet'
        integrity='sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC'
        crossorigin='anonymous'>

    <!-- Vue 3 -->
    <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.js'></script>
</head>
<body>
    <div id="app" class="container">
        <h1>Carpark Information</h1>
        <div id="carpark-container">
            <!-- Carpark data will be displayed here -->
        </div>
        <!-- Buttons to fetch carpark and user data -->
        <button onclick="fetchCarparkData()">See Carpark JSON</button>
        <button onclick="fetchUserData()">See Users JSON</button>
        <!-- Button to clear displayed data -->
        <button onclick="clearData()">Back</button>
    </div> <!-- app: container -->


    <!-- Add this iframe to include favourites.html -->
    <iframe id="favourites-frame" src="" style="position:fixed; 
    right:0; width:300px; height:100%; border:none;"></iframe>



    <script>

        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            const username = params.get('username');

            if(username) {
                console.log('Logged in as:', username);
                // Set the src for the iframe
                document.getElementById('favourites-frame').src = `favourites.html?username=${username}`;
                // Rest of your code...
            } else {
                // Redirect to the login page if no username is provided
                window.location.href = 'login.html';
            }
        });


        function fetchUserData() {
            fetch('http://127.0.0.1:5002/users')
                .then(response => response.json())
                .then(data => {
                    displayUserData(data.data.users);
                })
                .catch(error => console.error('Error fetching user data:', error));
        }

        function displayUserData(users) {
            const container = document.getElementById('carpark-container');
            container.innerHTML = ''; // Clear existing content

            if (!users || users.length === 0) {
                container.innerHTML = '<p>No user data available.</p>';
                return;
            }

            const list = document.createElement('ul');
            users.forEach(user => {
                const item = document.createElement('li');
                item.textContent = `Username: ${user.username}, Email: ${user.email}, Favourite: ${user.favourite}`;
                list.appendChild(item);
            });

            container.appendChild(list);
        }

        function fetchCarparkData() {
            fetch('http://127.0.0.1:5001/carparks/getAll') // Ensure this URL matches your Flask app's URL and port
                .then(response => response.json())
                .then(data => {
                    displayCarparkData(data.data.carparks);
                })
                .catch(error => console.error('Error fetching carpark data:', error));
        }

        function displayCarparkData(carparks) {
            const container = document.getElementById('carpark-container');
            container.innerHTML = ''; // Clear existing content

            if (!carparks || carparks.length === 0) {
                container.innerHTML = '<p>No carpark data available.</p>';
                return;
            }

            const list = document.createElement('ul');
            carparks.forEach(carpark => {
                const item = document.createElement('li');
                item.textContent = `Carpark No: ${carpark.carparkNo}, Coordinates: ${carpark.coordinates}, Lots Available: ${carpark.lotsAvailable}, Lot Type: ${carpark.lotType}`;
                list.appendChild(item);
            });

            container.appendChild(list);
        }

        function clearData() {
            document.getElementById('carpark-container').innerHTML = '';
        }
    </script>

    <!-- Bootstrap Javascript -->
    <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js'
        integrity='sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM'
        crossorigin='anonymous'></script>
</body>
</html>
