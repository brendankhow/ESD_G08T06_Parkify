<!doctype html>
<html lang="en">

<head>
    <title>Title</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css'
        rel='stylesheet'
        integrity='sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC'
        crossorigin='anonymous'>

    <!-- Vue 3 -->
    <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.js'></script>
    <!-- Vue 3: production version, optimized for size and speed -->
    <!-- <script src='https://cdn.jsdelivr.net/npm/vue@3.0.2/dist/vue.global.prod.js'></script> -->

</head>

<body>
    <div id="app" class="container">
        <h1>Carpark Information</h1>
        <div id="carpark-container">
            <!-- Carpark data will be displayed here -->
        </div>
        
    </div> <!-- app: container -->


    <div id="favourites-container" style="position:fixed; 
    left:0; bottom: 0px; width:300px; ; border:none; padding: 10px; overflow-y: scroll; height: 200px; background-color: lightblue;">
        <!-- Favourites will be displayed here -->
    </div>



    <script>

        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            const username = params.get('username');

            if(username) {
                console.log('Logged in as:', username);
                fetchFavourites(username);
                // Rest of your code...
            } else {
                // Redirect to the login page if no username is provided
                window.location.href = 'login.html';
            }
        });

        function fetchFavourites(username) {
            // Replace with the correct URL to fetch user favourites
            const url = `http://127.0.0.1:5002/users`;
            console.log('Fetch URL:', url);
            
            fetch(url)
                .then(response => {
                    console.log('Response:', response);
                    return response.json();
                })
                .then(data => {
                    console.log('DATA:', data);
                    console.log('Users:', data.data.users);
                    const userFavourites = data.data.users
                        .filter(user => user.username === username)
                        .map(user => user.favourite);
                    console.log('User favourites:', userFavourites);
                    displayFavourites(userFavourites);
                })
                .catch(error => console.error('Error fetching favourites:', error));
        }

        function displayFavourites(favourites) {
            const container = document.getElementById('favourites-container');
            container.innerHTML = ''; // Clear existing content

            if (!favourites || favourites.length === 0) {
                container.innerHTML = '<p>No favourites available.</p>';
                return;
            }

            // If favourites is an array, create a list of items
            const list = document.createElement('ul');
            favourites.forEach(favourite => {
                const item = document.createElement('li');
                item.textContent = favourite;
                item.style.color = 'black'; // Set text color to black
                list.appendChild(item);
            });
            container.appendChild(list);
        }



        function fetchUserData() {
            fetch('http://127.0.0.1:5002/users')
                .then(response => response.json())
                .then(data => {
                    displayUserData(data.data.users);
                })
                .catch(error => console.error('Error fetching user data:', error));
        }

        function displayUserData(users) {
            const container = document.getElementById('carpark-container');
            container.innerHTML = ''; // Clear existing content

            if (!users || users.length === 0) {
                container.innerHTML = '<p>No user data available.</p>';
                return;
            }

            const list = document.createElement('ul');
            users.forEach(user => {
                const item = document.createElement('li');
                item.textContent = `Username: ${user.username}, Email: ${user.email}, Favourite: ${user.favourite}`;
                list.appendChild(item);
            });

            container.appendChild(list);
        }

        function fetchCarparkData() {
            fetch('http://127.0.0.1:5001/carparks/getAll') // Ensure this URL matches your Flask app's URL and port
                .then(response => response.json())
                .then(data => {
                    displayCarparkData(data.data.carparks);
                })
                .catch(error => console.error('Error fetching carpark data:', error));
        }

        function displayCarparkData(carparks) {
            const container = document.getElementById('carpark-container');
            container.innerHTML = ''; // Clear existing content

            if (!carparks || carparks.length === 0) {
                container.innerHTML = '<p>No carpark data available.</p>';
                return;
            }

            const list = document.createElement('ul');
            carparks.forEach(carpark => {
                const item = document.createElement('li');
                item.textContent = `Carpark No: ${carpark.carparkNo}, Coordinates: ${carpark.coordinates}, Lots Available: ${carpark.lotsAvailable}, Lot Type: ${carpark.lotType}`;
                list.appendChild(item);
            });

            container.appendChild(list);
        }

        function clearData() {
            document.getElementById('carpark-container').innerHTML = '';
        }
    </script>

    
    <!-- Bootstrap Javascript -->
    <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js'
        integrity='sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM'
        crossorigin='anonymous'></script>
</body>
</html>
