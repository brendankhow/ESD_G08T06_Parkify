<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Carpark Locations</title>
</head>
<body>
    <div id="app">
        <input type="text" id="searchQuery" placeholder="Enter location">
        <button id="searchBtn">Search</button>
        <ul id="carparksList"></ul>
    </div>

    <script>
        // JavaScript code to handle search functionality
        document.getElementById('searchBtn').addEventListener('click', function() {
            // Retrieve search query from input field
            var searchQuery = document.getElementById('searchQuery').value;
            
            // Send search query to backend to fetch geocode
            fetch(`http://localhost:3001/locations?location=${searchQuery}`)
                .then(response => response.json())
                .then(data => {
                    // Once coordinates are fetched, call the method to fetch car park data
                    getCarParkData();
                })
                .catch(error => {
                    console.error('Error fetching locations:', error);
                });
        });

        function getCarParkData() {
            // Fetch car park data from getcarpark.py
            fetch('http://localhost:4002/data')
                .then(response => response.json())
                .then(data => {
                    // Update carparks with the new data
                    displayCarParkData(data);
                })
                .catch(error => {
                    console.error('Error fetching car park data:', error);
                });
        }

        function displayCarParkData(carparks) {
            var carparksList = document.getElementById('carparksList');
            carparksList.innerHTML = ''; // Clear existing content
            
            carparks.forEach(carpark => {
                var listItem = document.createElement('li');
                listItem.innerHTML = `
                    <div>Name: ${carpark.ppName}</div>
                    <div>Code: ${carpark.ppCode}</div>
                    <div>Coordinates: ${carpark.coordinates}</div>
                    <div>Distance: ${carpark.distance.toFixed(3)} km</div>
                    ${carpark.lotType ? `<div>Lot Type: ${carpark.lotType}</div>` : ''}
                    ${carpark.lotsAvailable ? `<div>Lots Available: ${carpark.lotsAvailable}</div>` : ''}
                    <div>Capacity: ${carpark.parkCapacity}</div>
                    <div>Parking System: ${carpark.parkingSystem}</div>
                    <div>Weekday Rate: ${carpark.weekdayRate}</div>
                    <div>Saturday Rate: ${carpark.satdayRate}</div>
                    <div>Sunday & Public Holiday Rate: ${carpark.sunPHRate}</div>
                    <div>Operating Hours: ${carpark.startTime} - ${carpark.endTime}</div>
                `;
                carparksList.appendChild(listItem);
            });
        }
    </script>
</body>
</html>
